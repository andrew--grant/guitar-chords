<progress-bar>

    <div id="{opts.id}" class="progress-line-container">
        <div class="progress-line"></div>
    </div>

    <style>
        .progress-line-container {
            height: 4px;
            width: 100%;
            margin: auto;
            margin-top: 0;
            padding: 0;
            /*max-width: 1000px;
            min-width: 800px;*/
            background-color: #000;
        }
        
        .progress-line {
            height: 100%;
            width: 100%;
            background-color: #f00;
        }
    </style>

    <script>
        var self = this;
        //self.progressStarted = false; 

        self.on('mount', function() {
            //console.log('mount ' + self.opts.loaded); // undefined 
            // self.startProgress(self.opts.duration * 1000);
        });

        self.on('update', function() {
            console.log('progress-bar update fired');
            // cant do this in mount, function 
            // is undefined at that point
            if (!this.progressStarted) {
                self.opts.loaded(self);
            } else {
                this.progressStarted = true;
            }
        });

        start() {
            self.startProgress(self.opts.duration * 1000);
        }

        startProgress(duration) {
            if (self.opts.start) {
                self.opts.start();
            }
            var endMillis = new Date().getTime() + parseInt(duration);
            var millisRightNow = null;
            var width = null;
            var interval = setInterval(function() {
                millisRightNow = new Date().getTime();
                if (endMillis >= millisRightNow) {
                    width = ((endMillis - millisRightNow) / duration) * 100;
                    width = Math.floor(width);
                    // todo: target a specific one, not all of them
                    $('progress-bar .progress-line').css('width', width + '%');
                    if (self.opts.progress) {
                        self.opts.progress();
                    }
                } else {
                    clearInterval(interval);
                    if (self.opts.end) {
                        self.opts.end();
                    }
                }
            }, self.opts.speed || 50);
        }
    </script>

</progress-bar>